description: |
  Creates a feature engineering query
implementation:
  container:
    args:
    - inputValue: project_id
    - inputValue: source_table_id
    - inputValue: threshold_date
    - inputValue: predict_end
    - inputValue: max_monetary
    - inputValue: query_template_uri
    - outputPath: Output
    command:
    - python3
    - -c
    - "def prepare_feature_engineering_query(\n    project_id: str,\n    source_table_id:\
      \ str,\n    threshold_date: str,\n    predict_end: str,\n    max_monetary: str,\n\
      \    query_template_uri: str) -> str:\n    \"\"\"Creates a feature engineering\
      \ query\"\"\"\n\n    from google.cloud import storage\n    import re\n    \n\
      \    # Read a query template from GCS\n    _, bucket, blob_name = re.split(\"\
      gs://|/\", query_template_uri, 2)\n    blob = storage.Client(project_id).get_bucket(bucket).blob(blob_name)\n\
      \    query_template = blob.download_as_string().decode('utf-8')\n\n    # Substitute\
      \ placeholders in the query template\n    query = query_template.format(\n \
      \       data_source_id=source_table_id,\n        threshold_date=threshold_date,\n\
      \        predict_end=predict_end,\n        max_monetary=max_monetary\n    )\n\
      \    \n    return query\n\nimport sys\n_args = {\n    'project_id': str(sys.argv[1]),\n\
      \    'source_table_id': str(sys.argv[2]),\n    'threshold_date': str(sys.argv[3]),\n\
      \    'predict_end': str(sys.argv[4]),\n    'max_monetary': str(sys.argv[5]),\n\
      \    'query_template_uri': str(sys.argv[6]),\n}\n_output_files = [\n    sys.argv[7],\n\
      ]\n\n_outputs = prepare_feature_engineering_query(**_args)\n\nif not hasattr(_outputs,\
      \ '__getitem__') or isinstance(_outputs, str):\n    _outputs = [_outputs]\n\n\
      from pathlib import Path\nfor idx, filename in enumerate(_output_files):\n \
      \   _output_path = Path(filename)\n    _output_path.parent.mkdir(parents=True,\
      \ exist_ok=True)\n    _output_path.write_text(str(_outputs[idx]))\n"
    image: marketplace.gcr.io/google/python:latest
inputs:
- name: project_id
  type: str
- name: source_table_id
  type: str
- name: threshold_date
  type: str
- name: predict_end
  type: str
- name: max_monetary
  type: str
- name: query_template_uri
  type: str
name: Prepare feature engineering query
outputs:
- name: Output
  type: str
